"use strict";(()=>{var e={};e.id=869,e.ids=[869],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32874:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var n={};r.r(n),r.d(n,{PUT:()=>c});var o=r(49303),a=r(88716),i=r(60670),s=r(87070),u=r(2021),d=r(97919);async function c(e){try{await (0,u.u)();let{userId:t,socialUsernames:r}=await e.json();console.log("\uD83D\uDCDD Updating onboarding data:",{userId:t,socialUsernames:r});let n=Object.entries(r).filter(([e,t])=>t&&"string"==typeof t&&t.trim()).map(([e,t])=>({platform:e,username:t.trim(),originalUsername:t.trim(),isActive:!0,createdAt:new Date})),o=Object.entries(r).filter(([e,t])=>t&&"string"==typeof t&&t.trim()).map(([e,t])=>({platform:e,username:`${t.trim()}_clips`,status:"pending",originalProfile:t.trim()})),a=await d.N.findOneAndUpdate({userId:t},{socialProfiles:n,clipAccounts:o,status:"processing",updatedAt:new Date},{new:!0});if(!a)return s.NextResponse.json({success:!1,message:"Dados do onboarding n\xe3o encontrados"},{status:404});return console.log("✅ Onboarding data updated successfully"),setTimeout(async()=>{try{await d.N.findByIdAndUpdate(a._id,{status:"completed","clipAccounts.$[].status":"created"}),console.log("✅ Clip accounts created successfully")}catch(e){console.error("❌ Error updating clip accounts:",e)}},5e3),s.NextResponse.json({success:!0,message:"Dados do onboarding atualizados com sucesso",data:{id:a._id,status:a.status,clipAccounts:a.clipAccounts}})}catch(e){return console.error("❌ Error updating onboarding data:",e),s.NextResponse.json({success:!1,message:"Erro ao atualizar dados do onboarding"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/onboarding/update/route",pathname:"/api/onboarding/update",filename:"route",bundlePath:"app/api/onboarding/update/route"},resolvedPagePath:"C:\\Users\\aluno\\OneDrive\\Desktop\\clipeiro\\app\\api\\onboarding\\update\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:l,staticGenerationAsyncStorage:g,serverHooks:m}=p,f="/api/onboarding/update/route";function y(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},2021:(e,t,r)=>{r.d(t,{u:()=>u});var n=r(11185),o=r.n(n);let a=process.env.MONGODB_URI||"mongodb+srv://clipeiroai:otaviosnow2012@cluster0.0afjdgs.mongodb.net/clipeiro?retryWrites=true&w=majority&appName=Cluster0";process.env.MONGODB_URI||console.warn("⚠️ MONGODB_URI n\xe3o definida nas vari\xe1veis de ambiente");let i={bufferCommands:!1,maxPoolSize:10,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,family:4,retryWrites:!0,w:"majority"},s=global.mongoose;async function u(){if(s.conn)return s.conn;s.promise||(s.promise=o().connect(a,i).then(e=>(console.log("✅ MongoDB connected successfully"),e)).catch(e=>{throw console.error("❌ MongoDB connection failed:",e.message),e}));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}s||(s=global.mongoose={conn:null,promise:null})},97919:(e,t,r)=>{r.d(t,{N:()=>i});var n=r(11185),o=r.n(n);let a=new(o()).Schema({userId:{type:String,required:!0,unique:!0},userEmail:{type:String,required:!0},objective:{type:String,required:!0},socialProfiles:[{platform:{type:String,enum:["instagram","tiktok","youtube"],required:!0},username:{type:String,required:!0},originalUsername:{type:String,required:!0},isActive:{type:Boolean,default:!0},createdAt:{type:Date,default:Date.now}}],productChoice:{type:String,enum:["clipeiro-ai"],required:!0},status:{type:String,enum:["pending","processing","completed"],default:"pending"},clipAccounts:[{platform:{type:String,required:!0},username:{type:String,required:!0},status:{type:String,enum:["created","pending","failed"],default:"pending"},originalProfile:{type:String,required:!0}}],createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});a.pre("save",function(e){this.updatedAt=new Date,e()});let i=o().models.OnboardingData||o().model("OnboardingData",a)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,972],()=>r(32874));module.exports=n})();